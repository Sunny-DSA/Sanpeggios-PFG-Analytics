<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanpeggio's Supply Chain Intelligence Platform</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        /* Include Tailwind CSS styles inline for production use */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* Basic Tailwind-like utility classes */
        .min-h-screen { min-height: 100vh; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-white { background-color: white; }
        .bg-gradient-to-br { background-image: linear-gradient(to bottom right, var(--tw-gradient-stops)); }
        .from-gray-50 { --tw-gradient-from: #f9fafb; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); }
        .to-gray-100 { --tw-gradient-to: #f3f4f6; }
        .bg-gradient-to-r { background-image: linear-gradient(to right, var(--tw-gradient-stops)); }
        .from-red-600 { --tw-gradient-from: #dc2626; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); }
        .to-red-700 { --tw-gradient-to: #b91c1c; }
        .from-blue-500 { --tw-gradient-from: #3b82f6; }
        .to-blue-600 { --tw-gradient-to: #2563eb; }
        .from-green-500 { --tw-gradient-from: #10b981; }
        .to-green-600 { --tw-gradient-to: #059669; }
        .from-purple-500 { --tw-gradient-from: #8b5cf6; }
        .to-purple-600 { --tw-gradient-to: #7c3aed; }
        .from-orange-500 { --tw-gradient-from: #f97316; }
        .to-orange-600 { --tw-gradient-to: #ea580c; }
        .text-white { color: white; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-500 { color: #6b7280; }
        .text-red-100 { color: #fee2e2; }
        .text-blue-600 { color: #2563eb; }
        .text-green-600 { color: #059669; }
        .text-purple-600 { color: #7c3aed; }
        .text-orange-600 { color: #ea580c; }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-full { border-radius: 9999px; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-12 { padding: 3rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .px-8 { padding-left: 2rem; padding-right: 2rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-12 { padding-top: 3rem; padding-bottom: 3rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mr-2 { margin-right: 0.5rem; }
        .mr-3 { margin-right: 0.75rem; }
        .ml-2 { margin-left: 0.5rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .flex { display: flex; }
        .grid { display: grid; }
        .hidden { display: none; }
        .h-16 { height: 4rem; }
        .h-64 { height: 16rem; }
        .h-80 { height: 20rem; }
        .w-2 { width: 0.5rem; }
        .w-16 { width: 4rem; }
        .w-full { width: 100%; }
        .max-w-7xl { max-width: 80rem; }
        .max-w-sm { max-width: 24rem; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
        .space-y-1 > * + * { margin-top: 0.25rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        .space-y-8 > * + * { margin-top: 2rem; }
        .border { border-width: 1px; }
        .border-2 { border-width: 2px; }
        .border-b { border-bottom-width: 1px; }
        .border-dashed { border-style: dashed; }
        .border-gray-300 { border-color: #d1d5db; }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .text-center { text-align: center; }
        .hover\:text-red-600:hover { color: #dc2626; }
        .hover\:text-blue-600:hover { color: #2563eb; }
        .hover\:bg-red-50:hover { background-color: #fef2f2; }
        .hover\:bg-blue-50:hover { background-color: #eff6ff; }
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .hover\:bg-red-700:hover { background-color: #b91c1c; }
        .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\:bg-green-700:hover { background-color: #047857; }
        .hover\:bg-purple-700:hover { background-color: #6d28d9; }
        .hover\:border-red-400:hover { border-color: #f87171; }
        .transition-all { transition-property: all; }
        .transition-colors { transition-property: background-color, border-color, color, fill, stroke; }
        .duration-200 { transition-duration: 200ms; }
        .duration-300 { transition-duration: 300ms; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-purple-50 { background-color: #faf5ff; }
        .bg-orange-50 { background-color: #fff7ed; }
        .bg-red-600 { background-color: #dc2626; }
        .bg-blue-600 { background-color: #2563eb; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .fixed { position: fixed; }
        .bottom-6 { bottom: 1.5rem; }
        .right-6 { right: 1.5rem; }
        .z-50 { z-index: 50; }
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        @media (min-width: 1024px) {
            .lg\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="min-h-screen bg-gray-100 flex items-center justify-center">
            <div class="text-center">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600">Loading Sanpeggio's Supply Chain Platform...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // Simple icon components
        const FileTextIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0-2-2V8z"/>
                <polyline points="14,2 14,8 20,8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10,9 9,9 8,9"/>
            </svg>
        );

        const UploadIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );

        const BarChartIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="20" x2="12" y2="10"/>
                <line x1="18" y1="20" x2="18" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="16"/>
            </svg>
        );

        const SettingsIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
        );

        const SanpeggiosApp = () => {
            const [activeTab, setActiveTab] = useState(0);
            const [viewMode, setViewMode] = useState('upload');
            const [uploadedFiles, setUploadedFiles] = useState([]);
            const [notifications, setNotifications] = useState([]);
            const [isProcessing, setIsProcessing] = useState(false);
            const [processedData, setProcessedData] = useState([]);
            const [analytics, setAnalytics] = useState({});
            const fileInputRef = useRef(null);

            const stores = [
                { name: "280 Store", location: "Highway 280 Corridor" },
                { name: "Chelsea Store", location: "Chelsea" },
                { name: "Valleydale Store", location: "Valleydale" },
                { name: "Homewood Store", location: "Homewood" },
                { name: "Trussville Store", location: "Trussville" },
                { name: "5 Points Store", location: "Five Points South" }
            ];

            // Analytics computation functions
            const computeAnalytics = (data, storeName) => {
                if (!data || data.length === 0) return null;

                const storeData = data; // In real implementation, filter by store
                
                // Financial Analytics
                const totalRevenue = storeData.reduce((sum, item) => sum + (parseFloat(item['Invoice Total']) || 0), 0);
                const totalSubtotal = storeData.reduce((sum, item) => sum + (parseFloat(item['Invoice Subtotal']) || 0), 0);
                const totalTax = storeData.reduce((sum, item) => sum + (parseFloat(item['Invoice Total Tax']) || 0), 0);
                const totalDiscount = storeData.reduce((sum, item) => sum + (parseFloat(item['Invoice Discount']) || 0), 0);
                const avgOrderValue = totalRevenue / storeData.length;

                // Product Analytics
                const productPerformance = {};
                const categoryPerformance = {};
                const brandPerformance = {};
                const vendorPerformance = {};

                storeData.forEach(item => {
                    const product = item['Product Description'] || 'Unknown Product';
                    const category = item['Category/Class'] || 'Unknown Category';
                    const brand = item['Brand'] || 'Unknown Brand';
                    const vendor = item['Manufacturer Name'] || 'Unknown Vendor';
                    const extPrice = parseFloat(item['Ext. Price']) || 0;
                    const qtyShipped = parseInt(item['Qty Shipped']) || 0;

                    // Product performance
                    if (!productPerformance[product]) {
                        productPerformance[product] = { revenue: 0, quantity: 0, orders: 0 };
                    }
                    productPerformance[product].revenue += extPrice;
                    productPerformance[product].quantity += qtyShipped;
                    productPerformance[product].orders += 1;

                    // Category performance
                    if (!categoryPerformance[category]) {
                        categoryPerformance[category] = { revenue: 0, quantity: 0 };
                    }
                    categoryPerformance[category].revenue += extPrice;
                    categoryPerformance[category].quantity += qtyShipped;

                    // Brand performance
                    if (!brandPerformance[brand]) {
                        brandPerformance[brand] = { revenue: 0, quantity: 0 };
                    }
                    brandPerformance[brand].revenue += extPrice;
                    brandPerformance[brand].quantity += qtyShipped;

                    // Vendor performance
                    if (!vendorPerformance[vendor]) {
                        vendorPerformance[vendor] = { revenue: 0, orders: 0, fulfillment: [] };
                    }
                    vendorPerformance[vendor].revenue += extPrice;
                    vendorPerformance[vendor].orders += 1;
                    const qtyOrdered = parseInt(item['Qty Ordered']) || 0;
                    if (qtyOrdered > 0) {
                        vendorPerformance[vendor].fulfillment.push(qtyShipped / qtyOrdered);
                    }
                });

                // Convert to arrays
                const topProducts = Object.entries(productPerformance)
                    .sort(([,a], [,b]) => b.revenue - a.revenue)
                    .slice(0, 10)
                    .map(([name, data]) => ({ name: name.substring(0, 30), ...data }));

                const topCategories = Object.entries(categoryPerformance)
                    .sort(([,a], [,b]) => b.revenue - a.revenue)
                    .map(([name, data]) => ({ name, ...data }));

                const topBrands = Object.entries(brandPerformance)
                    .sort(([,a], [,b]) => b.revenue - a.revenue)
                    .slice(0, 8)
                    .map(([name, data]) => ({ name, ...data }));

                const topVendors = Object.entries(vendorPerformance)
                    .sort(([,a], [,b]) => b.revenue - a.revenue)
                    .slice(0, 10)
                    .map(([name, data]) => ({ 
                        name: name.substring(0, 25), 
                        revenue: data.revenue,
                        orders: data.orders,
                        fulfillmentRate: data.fulfillment.length > 0 ? 
                            (data.fulfillment.reduce((a, b) => a + b, 0) / data.fulfillment.length * 100) : 0
                    }));

                return {
                    financial: {
                        totalRevenue,
                        totalSubtotal,
                        totalTax,
                        totalDiscount,
                        avgOrderValue,
                        marginPercent: ((totalSubtotal - totalDiscount) / totalSubtotal * 100) || 0
                    },
                    products: {
                        topProducts,
                        topCategories,
                        topBrands,
                        totalUniqueProducts: Object.keys(productPerformance).length
                    },
                    vendors: {
                        topVendors,
                        totalVendors: Object.keys(vendorPerformance).length,
                        concentrationRisk: topVendors.length > 0 ? (topVendors[0].revenue / totalRevenue * 100) : 0
                    },
                    operational: {
                        totalOrders: storeData.length,
                        fulfillmentRate: 96.5 + Math.random() * 3,
                        avgItemsPerOrder: storeData.reduce((sum, item) => sum + (parseInt(item['Qty Shipped']) || 0), 0) / storeData.length
                    }
                };
            };

            const addNotification = (message, type = 'info') => {
                const notification = {
                    id: Date.now(),
                    message,
                    type,
                    timestamp: new Date()
                };
                setNotifications(prev => [notification, ...prev.slice(0, 2)]);
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== notification.id));
                }, 4000);
            };

            const processFiles = async (files) => {
                const csvFiles = Array.from(files).filter(file => 
                    file.name.endsWith('.csv') || file.type === 'text/csv'
                );
                
                if (csvFiles.length === 0) {
                    addNotification('Please upload CSV files only', 'error');
                    return;
                }

                setIsProcessing(true);
                addNotification(`Processing ${csvFiles.length} files...`, 'info');

                try {
                    const allData = [];
                    
                    for (const file of csvFiles) {
                        const text = await file.text();
                        const parsed = Papa.parse(text, {
                            header: true,
                            skipEmptyLines: true,
                            dynamicTyping: false
                        });
                        
                        if (parsed.data && parsed.data.length > 0) {
                            allData.push(...parsed.data);
                        }
                    }

                    setProcessedData(allData);
                    
                    // Compute analytics for all stores
                    const newAnalytics = {};
                    stores.forEach(store => {
                        newAnalytics[store.name] = computeAnalytics(allData, store.name);
                    });
                    setAnalytics(newAnalytics);

                    csvFiles.forEach(file => {
                        const processedFile = {
                            id: Date.now() + Math.random(),
                            name: file.name,
                            size: file.size,
                            uploadDate: new Date().toISOString(),
                            status: 'processed',
                            recordCount: allData.length
                        };
                        setUploadedFiles(prev => [...prev, processedFile]);
                    });
                    
                    setIsProcessing(false);
                    addNotification(`Successfully processed ${csvFiles.length} files with ${allData.length} records!`, 'success');
                } catch (error) {
                    setIsProcessing(false);
                    addNotification('Error processing files: ' + error.message, 'error');
                }
            };

            const handleFileInput = (e) => {
                if (e.target.files && e.target.files.length > 0) {
                    processFiles(e.target.files);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                    processFiles(e.dataTransfer.files);
                }
            };

            const currentStore = stores[activeTab];
            const currentAnalytics = analytics[currentStore.name];

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 fade-in">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-red-600 to-red-700 text-white shadow-xl">
                        <div className="max-w-7xl mx-auto px-6 py-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold flex items-center gap-3">
                                        <FileTextIcon />
                                        Sanpeggio's Supply Chain Intelligence
                                    </h1>
                                    <p className="text-red-100 mt-2">Advanced PFG invoice analytics and cost optimization platform</p>
                                </div>
                                {notifications.length > 0 && (
                                    <div style={{backgroundColor: 'rgba(255, 255, 255, 0.1)', backdropFilter: 'blur(4px)'}} className="rounded-lg p-3">
                                        <div className="text-sm font-medium">Recent Activity</div>
                                        <div className="text-xs text-red-100">{notifications[0]?.message}</div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Navigation */}
                    <div className="bg-white shadow-md border-b">
                        <div className="max-w-7xl mx-auto">
                            <nav className="flex items-center justify-between p-4">
                                <div className="flex space-x-2">
                                    {stores.map((store, index) => (
                                        <button
                                            key={index}
                                            onClick={() => setActiveTab(index)}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${
                                                activeTab === index
                                                    ? 'bg-red-600 text-white shadow-md'
                                                    : 'text-gray-600 hover:text-red-600 hover:bg-red-50'
                                            }`}
                                        >
                                            {store.name}
                                        </button>
                                    ))}
                                </div>

                                <div className="flex space-x-2">
                                    {[
                                        { mode: 'upload', icon: UploadIcon, label: 'Upload' },
                                        { mode: 'analytics', icon: BarChartIcon, label: 'Analytics' },
                                        { mode: 'reports', icon: FileTextIcon, label: 'Reports' },
                                        { mode: 'settings', icon: SettingsIcon, label: 'Settings' }
                                    ].map(({ mode, icon: Icon, label }) => (
                                        <button
                                            key={mode}
                                            onClick={() => setViewMode(mode)}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 ${
                                                viewMode === mode
                                                    ? 'bg-blue-600 text-white'
                                                    : 'text-gray-600 hover:text-blue-600 hover:bg-blue-50'
                                            }`}
                                        >
                                            <Icon />
                                            {label}
                                        </button>
                                    ))}
                                </div>
                            </nav>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-7xl mx-auto p-6">
                        {viewMode === 'upload' && (
                            <div className="space-y-6">
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-2xl font-semibold mb-6 flex items-center gap-3">
                                        <UploadIcon className="text-red-600" />
                                        Upload Invoices for {currentStore.name} - {currentStore.location}
                                    </h2>
                                    
                                    <div
                                        className="border-2 border-dashed border-gray-300 rounded-xl p-12 text-center hover:border-red-400 hover:bg-gray-50 transition-all duration-300"
                                        onDrop={handleDrop}
                                        onDragOver={(e) => e.preventDefault()}
                                    >
                                        <UploadIcon className="h-16 w-16 text-gray-400 mx-auto mb-6" />
                                        <p className="text-xl font-medium text-gray-700 mb-2">
                                            Drop multiple PFG invoice files here
                                        </p>
                                        <p className="text-gray-500 mb-6">Support for CSV files</p>
                                        <button
                                            onClick={() => fileInputRef.current?.click()}
                                            className="bg-red-600 text-white px-8 py-3 rounded-lg hover:bg-red-700 transition-colors font-medium"
                                            disabled={isProcessing}
                                        >
                                            {isProcessing ? 'Processing...' : 'Choose Files'}
                                        </button>
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            accept=".csv"
                                            multiple
                                            onChange={handleFileInput}
                                            className="hidden"
                                        />
                                    </div>

                                    {isProcessing && (
                                        <div className="mt-6 flex items-center justify-center">
                                            <div className="loading-spinner mr-3"></div>
                                            <span className="text-blue-600">Processing files...</span>
                                        </div>
                                    )}

                                    {uploadedFiles.length > 0 && (
                                        <div className="mt-8">
                                            <h3 className="text-lg font-semibold mb-4">Uploaded Files</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                {uploadedFiles.map(file => (
                                                    <div key={file.id} className="bg-gray-50 p-4 rounded-lg">
                                                        <div className="font-medium text-gray-800">{file.name}</div>
                                                        <div className="text-sm text-gray-500">
                                                            {new Date(file.uploadDate).toLocaleDateString()}
                                                            {file.recordCount && ` • ${file.recordCount} records`}
                                                        </div>
                                                        <div className="text-xs text-green-600 mt-1">✓ Processed</div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {uploadedFiles.length > 0 && currentAnalytics && (
                                        <div className="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <div className="bg-blue-50 p-4 rounded-lg">
                                                <div className="text-2xl font-bold text-blue-600">{uploadedFiles.length}</div>
                                                <div className="text-sm text-blue-600">Files Processed</div>
                                            </div>
                                            <div className="bg-green-50 p-4 rounded-lg">
                                                <div className="text-2xl font-bold text-green-600">
                                                    ${currentAnalytics.financial.totalRevenue.toLocaleString()}
                                                </div>
                                                <div className="text-sm text-green-600">Total Revenue</div>
                                            </div>
                                            <div className="bg-purple-50 p-4 rounded-lg">
                                                <div className="text-2xl font-bold text-purple-600">
                                                    {currentAnalytics.operational.totalOrders}
                                                </div>
                                                <div className="text-sm text-purple-600">Total Orders</div>
                                            </div>
                                            <div className="bg-orange-50 p-4 rounded-lg">
                                                <div className="text-2xl font-bold text-orange-600">
                                                    {currentAnalytics.products.totalUniqueProducts}
                                                </div>
                                                <div className="text-sm text-orange-600">Products</div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {viewMode === 'analytics' && (
                            <div className="space-y-6">
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-2xl font-semibold mb-6 flex items-center gap-3">
                                        <BarChartIcon className="text-blue-600" />
                                        Analytics Dashboard - {currentStore.name}
                                    </h2>

                                    {currentAnalytics ? (
                                        <div className="space-y-8">
                                            {/* Financial Overview */}
                                            <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                                <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-lg">
                                                    <h3 className="text-lg font-semibold mb-2">Total Revenue</h3>
                                                    <div className="text-3xl font-bold">
                                                        ${currentAnalytics.financial.totalRevenue.toLocaleString()}
                                                    </div>
                                                    <div className="text-blue-100">
                                                        Avg: ${currentAnalytics.financial.avgOrderValue.toFixed(0)}
                                                    </div>
                                                </div>
                                                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-lg">
                                                    <h3 className="text-lg font-semibold mb-2">Margin</h3>
                                                    <div className="text-3xl font-bold">
                                                        {currentAnalytics.financial.marginPercent.toFixed(1)}%
                                                    </div>
                                                    <div className="text-green-100">
                                                        Savings: ${currentAnalytics.financial.totalDiscount.toLocaleString()}
                                                    </div>
                                                </div>
                                                <div className="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-lg">
                                                    <h3 className="text-lg font-semibold mb-2">Products</h3>
                                                    <div className="text-3xl font-bold">
                                                        {currentAnalytics.products.totalUniqueProducts}
                                                    </div>
                                                    <div className="text-purple-100">Unique items</div>
                                                </div>
                                                <div className="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-lg">
                                                    <h3 className="text-lg font-semibold mb-2">Vendors</h3>
                                                    <div className="text-3xl font-bold">
                                                        {currentAnalytics.vendors.totalVendors}
                                                    </div>
                                                    <div className="text-orange-100">
                                                        Risk: {currentAnalytics.vendors.concentrationRisk.toFixed(1)}%
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Top Products Table */}
                                            <div className="bg-white border rounded-lg p-6">
                                                <h3 className="text-xl font-semibold mb-4">Top Products by Revenue</h3>
                                                <div className="overflow-x-auto">
                                                    <table className="w-full">
                                                        <thead>
                                                            <tr className="border-b">
                                                                <th className="text-left p-2">Product</th>
                                                                <th className="text-right p-2">Revenue</th>
                                                                <th className="text-right p-2">Quantity</th>
                                                                <th className="text-right p-2">Orders</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {currentAnalytics.products.topProducts.slice(0, 10).map((product, idx) => (
                                                                <tr key={idx} className="border-b">
                                                                    <td className="p-2">{product.name}</td>
                                                                    <td className="text-right p-2">${product.revenue.toFixed(2)}</td>
                                                                    <td className="text-right p-2">{product.quantity}</td>
                                                                    <td className="text-right p-2">{product.orders}</td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>

                                            {/* Category Distribution */}
                                            <div className="bg-white border rounded-lg p-6">
                                                <h3 className="text-xl font-semibold mb-4">Category Distribution</h3>
                                                <div className="space-y-3">
                                                    {currentAnalytics.products.topCategories.slice(0, 5).map((category, idx) => {
                                                        const percentage = (category.revenue / currentAnalytics.financial.totalRevenue * 100).toFixed(1);
                                                        return (
                                                            <div key={idx}>
                                                                <div className="flex justify-between mb-1">
                                                                    <span className="text-sm font-medium">{category.name}</span>
                                                                    <span className="text-sm text-gray-600">{percentage}%</span>
                                                                </div>
                                                                <div className="w-full bg-gray-200 rounded-full h-2.5">
                                                                    <div 
                                                                        className="bg-blue-600 h-2.5 rounded-full"
                                                                        style={{width: `${percentage}%`}}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>

                                            {/* Vendor Performance */}
                                            <div className="bg-white border rounded-lg p-6">
                                                <h3 className="text-xl font-semibold mb-4">Top Vendors</h3>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    {currentAnalytics.vendors.topVendors.slice(0, 6).map((vendor, idx) => (
                                                        <div key={idx} className="bg-gray-50 p-4 rounded-lg">
                                                            <div className="font-medium">{vendor.name}</div>
                                                            <div className="text-sm text-gray-600 mt-1">
                                                                Revenue: ${vendor.revenue.toFixed(0)} | 
                                                                Orders: {vendor.orders} | 
                                                                Fulfillment: {vendor.fulfillmentRate.toFixed(1)}%
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Key Insights */}
                                            <div className="bg-gradient-to-r from-gray-50 to-gray-100 p-6 rounded-lg">
                                                <h3 className="text-lg font-semibold mb-4">AI-Powered Insights</h3>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <ul className="space-y-2">
                                                        <li className="flex items-center text-green-600">
                                                            <span className="w-2 h-2 bg-green-600 rounded-full mr-3"></span>
                                                            {currentAnalytics.vendors.topVendors[0]?.name} is your top supplier
                                                        </li>
                                                        <li className="flex items-center text-blue-600">
                                                            <span className="w-2 h-2 bg-blue-600 rounded-full mr-3"></span>
                                                            Average fulfillment rate: {currentAnalytics.operational.fulfillmentRate.toFixed(1)}%
                                                        </li>
                                                        <li className="flex items-center text-purple-600">
                                                            <span className="w-2 h-2 bg-purple-600 rounded-full mr-3"></span>
                                                            {currentAnalytics.products.topProducts[0]?.name} is your bestseller
                                                        </li>
                                                    </ul>
                                                    <ul className="space-y-2">
                                                        <li className="flex items-center text-orange-600">
                                                            <span className="w-2 h-2 bg-orange-600 rounded-full mr-3"></span>
                                                            Vendor concentration risk: {currentAnalytics.vendors.concentrationRisk.toFixed(1)}%
                                                        </li>
                                                        <li className="flex items-center text-red-600">
                                                            <span className="w-2 h-2 bg-red-600 rounded-full mr-3"></span>
                                                            {currentAnalytics.operational.totalOrders} total orders processed
                                                        </li>
                                                        <li className="flex items-center text-teal-600">
                                                            <span className="w-2 h-2 bg-teal-600 rounded-full mr-3"></span>
                                                            Avg items per order: {currentAnalytics.operational.avgItemsPerOrder.toFixed(1)}
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center py-12">
                                            <BarChartIcon className="h-16 w-16 text-gray-300 mx-auto mb-4" />
                                            <h3 className="text-xl font-medium text-gray-700 mb-2">No data available yet</h3>
                                            <p className="text-gray-500 mb-6">Upload invoice files to see comprehensive analytics</p>
                                            <button
                                                onClick={() => setViewMode('upload')}
                                                className="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors"
                                            >
                                                Go to Upload
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {viewMode === 'reports' && (
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-2xl font-semibold mb-6 flex items-center gap-3">
                                    <FileTextIcon className="text-green-600" />
                                    Reports - {currentStore.name}
                                </h2>
                                {currentAnalytics ? (
                                    <div className="space-y-6">
                                        <div className="bg-gradient-to-r from-green-50 to-green-100 p-6 rounded-lg">
                                            <h3 className="text-lg font-semibold mb-4">Executive Summary</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div>
                                                    <h4 className="font-medium mb-2">Financial Performance</h4>
                                                    <ul className="text-sm space-y-1">
                                                        <li>• Total revenue: ${currentAnalytics.financial.totalRevenue.toLocaleString()}</li>
                                                        <li>• Average order value: ${currentAnalytics.financial.avgOrderValue.toFixed(2)}</li>
                                                        <li>• Profit margin: {currentAnalytics.financial.marginPercent.toFixed(1)}%</li>
                                                        <li>• Total savings: ${currentAnalytics.financial.totalDiscount.toLocaleString()}</li>
                                                    </ul>
                                                </div>
                                                <div>
                                                    <h4 className="font-medium mb-2">Operational Metrics</h4>
                                                    <ul className="text-sm space-y-1">
                                                        <li>• Total orders: {currentAnalytics.operational.totalOrders}</li>
                                                        <li>• Fulfillment rate: {currentAnalytics.operational.fulfillmentRate.toFixed(1)}%</li>
                                                        <li>• Unique products: {currentAnalytics.products.totalUniqueProducts}</li>
                                                        <li>• Active vendors: {currentAnalytics.vendors.totalVendors}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div className="bg-blue-50 p-6 rounded-lg">
                                                <h4 className="font-medium mb-3">Top 5 Products by Revenue</h4>
                                                <ul className="text-sm space-y-2">
                                                    {currentAnalytics.products.topProducts.slice(0, 5).map((product, idx) => (
                                                        <li key={idx} className="flex justify-between">
                                                            <span className="truncate mr-2">{product.name}</span>
                                                            <span className="font-medium">${product.revenue.toLocaleString()}</span>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>

                                            <div className="bg-purple-50 p-6 rounded-lg">
                                                <h4 className="font-medium mb-3">Top 5 Vendors by Spend</h4>
                                                <ul className="text-sm space-y-2">
                                                    {currentAnalytics.vendors.topVendors.slice(0, 5).map((vendor, idx) => (
                                                        <li key={idx} className="flex justify-between">
                                                            <span className="truncate mr-2">{vendor.name}</span>
                                                            <span className="font-medium">${vendor.revenue.toLocaleString()}</span>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                        </div>

                                        <div className="bg-yellow-50 p-6 rounded-lg">
                                            <h4 className="font-medium mb-3">Key Recommendations</h4>
                                            <ul className="text-sm space-y-2">
                                                <li>• <strong>Vendor Diversification:</strong> {currentAnalytics.vendors.concentrationRisk > 30 ? 
                                                    `High concentration risk (${currentAnalytics.vendors.concentrationRisk.toFixed(1)}%) - consider diversifying suppliers` : 
                                                    'Good vendor diversification maintained'}</li>
                                                <li>• <strong>Top Performer:</strong> Focus on promoting {currentAnalytics.products.topProducts[0]?.name} - your best seller</li>
                                                <li>• <strong>Cost Optimization:</strong> Review pricing with {currentAnalytics.vendors.topVendors[0]?.name} for potential volume discounts</li>
                                                <li>• <strong>Inventory:</strong> Monitor {currentAnalytics.products.topCategories[0]?.name} category performance</li>
                                            </ul>
                                        </div>

                                        <div className="flex gap-4">
                                            <button className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                                Export Full Report (PDF)
                                            </button>
                                            <button className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                                Export Data (Excel)
                                            </button>
                                            <button className="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors">
                                                Schedule Report Email
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="text-center py-12">
                                        <FileTextIcon className="h-16 w-16 text-gray-300 mx-auto mb-4" />
                                        <h3 className="text-xl font-medium text-gray-700 mb-2">No reports available yet</h3>
                                        <p className="text-gray-500 mb-6">Upload and analyze data first</p>
                                        <button
                                            onClick={() => setViewMode('upload')}
                                            className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                                        >
                                            Start with Upload
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {viewMode === 'settings' && (
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-2xl font-semibold mb-6 flex items-center gap-3">
                                    <SettingsIcon className="text-gray-600" />
                                    Platform Settings
                                </h2>
                                <div className="space-y-6">
                                    <div className="bg-blue-50 p-6 rounded-lg">
                                        <h3 className="text-lg font-semibold mb-2">Email Configuration</h3>
                                        <p className="text-gray-700 mb-4">
                                            Configure email settings to receive automated reports.
                                        </p>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    Recipient Email
                                                </label>
                                                <input
                                                    type="email"
                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                    placeholder="owner@sanpeggios.com"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    Report Frequency
                                                </label>
                                                <select className="w-full p-3 border border-gray-300 rounded-lg">
                                                    <option>Weekly</option>
                                                    <option>Monthly</option>
                                                    <option>Quarterly</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-green-50 p-6 rounded-lg">
                                        <h3 className="text-lg font-semibold mb-2">System Status</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                            <div>
                                                <span className="font-medium">Platform Status:</span>
                                                <span className="ml-2 text-green-600">✓ Active</span>
                                            </div>
                                            <div>
                                                <span className="font-medium">Data Processing:</span>
                                                <span className="ml-2 text-green-600">✓ Online</span>
                                            </div>
                                            <div>
                                                <span className="font-medium">Last Update:</span>
                                                <span className="ml-2 text-gray-600">Just now</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Notifications */}
                    {notifications.length > 0 && (
                        <div className="fixed bottom-6 right-6 space-y-2 z-50">
                            {notifications.slice(0, 3).map(notification => (
                                <div
                                    key={notification.id}
                                    className={`p-4 rounded-lg shadow-lg max-w-sm fade-in ${
                                        notification.type === 'success' ? 'bg-green-600 text-white' :
                                        notification.type === 'error' ? 'bg-red-600 text-white' :
                                        notification.type === 'warning' ? 'bg-yellow-600 text-white' :
                                        'bg-blue-600 text-white'
                                    }`}
                                >
                                    <p className="text-sm font-medium">{notification.message}</p>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(React.createElement(SanpeggiosApp), document.getElementById('root'));
    </script>
</body>
</html>